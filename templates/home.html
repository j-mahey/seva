{% extends "base.html" %}

{% block content %}
<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
<!-- ~~~~~~~~~~~~~ LOGOUT -->
<div class="logout">
    <form action="/logout/" method="POST">{% csrf_token %}
        <div>
            <input type="hidden" name="action" value="logout">
            <p>Logged In : <i><b>{{ user.username }}</b></i></p>
            {% if results_code == 1 %}
                <p class="success">{{ date }} : &nbsp;<i><b>{{ results }}</b></i></p>
            {% else %}
                <p class="fail">{{ date }} : &nbsp;<i><b>{{ results }}</b></i></p>
            {% endif %}
            <button type="submit" value="logout">Log Out</button>
        </div>
    </form>
</div>

<div class="tabs">
    <!-- ~~~~~~~~~~~~~ CLOCK -->
    <input class="tabs-select tabs-radio" type="radio" name="set" id="clock" checked="checked">
    <label class="tabs-select" for="clock"><b>CLOCK</b></label>
    <div class="tab clock">
        <form class="clock-search" method="GET">
            <input type="hidden" name="action" value="clock-search">
            <div>
                <select name="centre-search" required>
                    {% for c in centres %}
                    <option value={{c}}>{{c}}</option>
                    {% endfor %}
                </select>
                <input type="text" placeholder="Enter Badge or Vehicle Number" name="query" />
                <button type="submit">Search</button>
            </div>
        </form>
        <div><p>&nbsp;&nbsp;&nbsp;&nbsp;</p></div>
        {% if persons|length > 0 %}
        <form class="clock-in" action="" method="POST">{% csrf_token %}
            <input type="hidden" name="action" value="clock-in">
            {% if vehicles|length > 0 %}
            <table>
                <thead>
                <tr>
                    <th colspan="4">VEHICLE INFO</th>
                </tr>
                <tr>
                    <th>Vehicle No</th>
                    <th>Custom Id</th>
                    <th>Person</th>
                    <th>Type</th>
                </tr>
            </thead>
            <tbody>
                {% for vehicle in vehicles %}
                <tr>
                    <td>
                        <input type="radio" id={{vehicle.vehicle_no}} name="vehicle" value={{vehicle.vehicle_no}}>
                        <label for={{vehicle.vehicle_no}}>{{ vehicle.vehicle_no }}</label>
                    </td>
                    <td>{{ vehicle.custom_id }}</td>
                    <td>{{ vehicle.person.badge }}</td>
                    <td>{{ vehicle.get_type_display }}</td>
                </tr>
                {% endfor %}
            </tbody>
            </table>
            {% endif %}
            <table>
                <thead>
                <tr>
                    <th colspan="6">PERSON INFO</th>
                </tr>
                <tr>
                    <th>Badge</th>
                    <th>Full Name</th>
                    <th>Department</th>
                    <th>Gender</th>
                    <th>Contact Number</th>
                </tr>
                </thead>
                <tbody>
                {% for person in persons %}
                <tr>
                    <td>
                        <input type="radio" id={{person.badge}} name="person" value={{person.centre_badge}} required>
                        <label for={{person.badge}}>{{ person.badge }}</label>
                    </td>
                    <td>{{ person.full_name }}</td>
                    <td>{{ person.department }}</td>
                    <td>{{ person.get_gender_display }}</td>
                    <td>{{ person.contact_number }}</td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
            <button type="submit">Clock In</button>
        </form>
        {% endif %}
    </div>

    <!-- ~~~~~~~~~~~~~ ENTRY -->
    <input class="tabs-select tabs-radio" type="radio" name="set" id="entry">
    <label class="tabs-select" for="entry"><b>ENTRY</b></label>
    <div class="tab entry">
        <form action="" method="POST">{% csrf_token %}
            <input type="hidden" name="action" value="create-person">
            <div id="field_type">
                <label>Type : </label>
                {{ person_form.type }}
            </div>
            <div id="field_centre">
                <label >Centre : </label>
                {{ person_form.centre }}
            </div>
            <div id="field_badge">
                <label>Badge : </label>
                {{ person_form.badge }}
            </div>
            <div id="field_full_name">
                <label>Full Name : </label>
                {{ person_form.full_name }}
            </div>
            <div id="field_contact_number">
                <label>Contact Number : </label>
                {{ person_form.contact_number }}
            </div>
            <div id="field_gender">
                <label>Gender : </label>
                {{ person_form.gender }}
            </div>
            <div id="field_department">
                <label>Department : </label>
                {{ person_form.department }}
            </div>
            <div>
                <label for="clock-in">Clock In :  </label>
                <input type="checkbox" id="clock-in" name="clock-in" value="clock-in">
            </div>
            <button type="submit">Create Person</button>
        </form>
        <div><p>&nbsp;&nbsp;&nbsp;&nbsp;</p></div>
        <form action="" method="POST">{% csrf_token %}
            <input type="hidden" name="action" value="create-vehicle">
            <div>
                <label>Centre : </label>
                {{ vh_form.centre }}
            </div>
            <div>
                <label>Badge : </label>
                {{ vh_form.badge }}
            </div>
            <div>
                <label>Type : </label>
                {{ vh_form.type }}
            </div>
            <div>
                <label>Vehicle No. : </label>
                {{ vh_form.vehicle_no }}
            </div>
            <div>
                <label for="clock-in">Clock In : </label>
                <input type="checkbox" id="clock-in" name="clock-in" value="clock-in">
            </div>
            <button type="submit">Create Vehicle</button>
        </form>
    </div>

    <!-- ~~~~~~~~~~~~~ REPORT -->
    <input class="tabs-select tabs-radio" type="radio" name="set" id="report">
    <label class="tabs-select" for="report"><b>REPORT</b></label>
    <div class="tab report">
        {% if movement_in|length > 0 %}
        <form class="clock-out" action="" method="POST">{% csrf_token %}
            <input type="hidden" name="action" value="clock-out">
            <table>
                <thead>
                <tr>
                    <th colspan="9">CLOCKED IN : {{movement_in|length}}</th>
                </tr>
                <tr>
                    <th></th>
                    <th>Centre</th>
                    <th>Badge</th>
                    <th>Type</th>
                    <th>Full Name</th>
                    <th>Contact</th>
                    <th>Vehicle No</th>
                    <th>Vehicle Type</th>
                    <th>In Time</th>
                </tr>
            </thead>
            <tbody>
                {% for mov in movement_in %}
                <tr>
                    <td>
                        <input type="radio" id={{mov.person.badge}} name="clock-out" value={{mov.id}}>
                        <label for={{mov.person.badge}}></label>
                    </td>
                    <td>{{ mov.person.centre }}</td>
                    <td>{{ mov.person.badge }}</td>
                    <td>{{ mov.person.type }}</td>
                    <td>{{ mov.person.full_name }}</td>
                    <td>{{ mov.person.contact_number }}</td>
                    <td>{{ mov.vehicle.vehicle_no }}</td>
                    <td>{{ mov.vehicle.get_type_display }}</td>
                    <td>{{ mov.in_time }}</td>
                </tr>
                {% endfor %}
            </tbody>
            </table>
            <button type="submit">Clock Out</button>
        </form>
        {% else %}
        <p>No one currently clocked in.</p>
        {% endif %}
        <div><p>&nbsp;&nbsp;&nbsp;&nbsp;</p></div>
        <table>
            <thead>
            <tr>
                <th colspan="10">TODAY ATTENDENCE : {{movement_all|length}}</th>
            </tr>
            <tr>
                <th>Centre</th>
                <th>Badge</th>
                <th>Type</th>
                <th>Full Name</th>
                <th>Contact</th>
                <th>Vehicle No</th>
                <th>Vehicle Type</th>
                <th>Date</th>
                <th>In Time</th>
                <th>Out Time</th>
            </tr>
        </thead>
        {% if movement_all|length > 0 %}
        <tbody>
            {% for mov in movement_all %}
            <tr>
                <td>{{ mov.person.centre }}</td>
                <td>{{ mov.person.badge }}</td>
                <td>{{ mov.person.type }}</td>
                <td>{{ mov.person.full_name }}</td>
                <td>{{ mov.person.contact_number }}</td>
                <td>{{ mov.vehicle.vehicle_no }}</td>
                <td>{{ mov.vehicle.get_type_display }}</td>
                <td>{{ mov.date }}</td>
                <td>{{ mov.in_time }}</td>
                <td>{{ mov.out_time }}</td>
            </tr>
            {% endfor %}
        </tbody>
        </table>
        {% endif %}
        <div><p>&nbsp;&nbsp;&nbsp;&nbsp;</p></div>
        <table>
            <thead>
                <tr>
                    <th colspan="4">DEPARTMENT REPORT</th>
                </tr>
                <tr>
                    <th>NAME</th>
                    <th># MALE : {{dept_summary.total.male}}</th>
                    <th># FEMALE : {{dept_summary.total.female}}</th>
                    <th>TOTAL : {{dept_summary.total.total}}</th>
                </tr>
            </thead>
            <tbody>
                {% for dept in dept_summary.depts %}
                    {% if dept.total > 0%}
                    <tr>
                        <td>{{ dept.department }}</td>
                        <td>{{ dept.male }}</td>
                        <td>{{ dept.female }}</td>
                        <td>{{ dept.total }}</td>
                    </tr>
                    {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock content %}